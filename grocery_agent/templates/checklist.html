{% extends "base.html" %}
{% block title %}Grocery list – Grocery Agent{% endblock %}
{% block head %}
  <style>
    .checklist-list { list-style: none; padding: 0; margin: 0; }
    .checklist-item {
      display: flex;
      align-items: center;
      gap: 0.65rem;
      flex-wrap: wrap;
      padding: 0.6rem 0.85rem;
      margin-bottom: 0.4rem;
      background: var(--surface);
      border: var(--pixel) solid var(--border);
      border-radius: var(--radius);
      box-shadow: 2px 2px 0 var(--border);
      font-size: 1.1rem;
      line-height: 1.4;
      border-left-width: 4px;
      min-height: 2.75rem;
    }
    .checklist-item-pantry { border-left-color: #b45309; }
    .checklist-item-weekly { border-left-color: #059669; }
    .checklist-item input[type=checkbox] { width: 1.15rem; height: 1.15rem; cursor: pointer; }
    .checklist-item label { margin: 0; min-width: 5rem; font-size: 1.05rem; font-weight: 400; cursor: pointer; }
    .checklist-item .checklist-name { flex: 1; min-width: 0; font-size: 1.1rem; }
    .checklist-item .checklist-meta { font-size: 1rem; color: var(--muted); }
    .checklist-extra {
      margin-top: 1.25rem;
      padding-top: 1rem;
      border-top: 2px solid var(--border);
    }
    .checklist-extra label { font-size: 1.05rem; }
    .checklist-extra input { max-width: 20rem; }
    .checklist-extra .extra-row { display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.5rem; }
    .checklist-extra .extra-row input { flex: 1; min-width: 0; }
  </style>
{% endblock %}
{% block content %}
  <nav class="nav"><a href="/">Home</a> · <strong style="color: var(--text);">Checklist</strong></nav>
  <h1>Your grocery list</h1>
  <p class="muted">{% for r in recipes %}{{ r.name }} ({{ r.portions | int }} portions){% if not loop.last %}; {% endif %}{% endfor %}</p>
  <p class="muted" style="margin-bottom: 0.75rem;">Check items to order. <span style="color: #b45309;">■</span> Pantry (unchecked by default) · <span style="color: #059669;">■</span> Weekly.</p>

  <form method="post" action="/list/household">
    <input type="hidden" name="recipe_ids" value="{{ recipe_ids | join(',') }}">
    {% for rid, portion in recipe_portions %}
    <input type="hidden" name="portion_{{ rid }}" value="{{ portion }}">
    {% endfor %}
    <ul class="checklist-list">
      {% for ing in ingredients_display %}
      <li class="checklist-item checklist-item-{{ 'pantry' if ing.pantry_item else 'weekly' }}">
        <input type="checkbox" name="item_index" value="{{ ing.index }}" id="item_{{ ing.index }}" {{ 'checked' if not ing.pantry_item else '' }}>
        <label for="item_{{ ing.index }}" class="muted">{{ ing.amount_str }}</label>
        <span class="checklist-name">{{ ing.name }}{% if ing.optional %} <span class="muted" style="font-style: italic;">(optional)</span>{% endif %}</span>
        <span class="checklist-meta">{{ ing.form }}</span>
        <span class="checklist-meta">{{ ing.category }}</span>
      </li>
      {% endfor %}
    </ul>

    <div class="checklist-extra card">
      <h2 style="margin-top: 0; font-size: 1.1rem;">Add extra items</h2>
      <p class="muted" style="margin-bottom: 0.5rem;">Add any other items you want on the list (one per line). Leave empty to skip.</p>
      <label for="extra_items">Extra items</label>
      <textarea id="extra_items" name="extra_items" rows="4" placeholder="e.g.&#10;dish soap&#10;paper towels&#10;bread" style="margin-top: 0.25rem;"></textarea>
    </div>

    <button type="submit" style="margin-top: 0.75rem;">Continue to household items</button>
  </form>
  <p style="margin-top: 1.25rem;"><a href="/">Change recipes</a></p>
{% endblock %}
